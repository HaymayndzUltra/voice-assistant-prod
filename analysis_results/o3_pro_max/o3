======================================================================
COMPREHENSIVE MAIN-PC SYSTEM ANALYSIS  (2025-07-19)
======================================================================

The notes below are already formatted as a single block so you can
copy-paste them in one go.  They are split into four logical phases
matching your request.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 1 â€“ CODE-BASE AUDIT  â–¸  Syntax & StaticÂ­-Analysis
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1.1  Incomplete statements
     â€¢  50 + lines that contain nothing but the token  self.
     â€¢  38 of them live in the Main-PC tree; the rest are in pc2_code.
       Core-service hits (blocking the boot sequence):
         main_pc_code/agents/request_coordinator.py   818, 880, 882
         main_pc_code/agents/unified_system_agent.py  678, 717
         main_pc_code/agents/predictive_health_monitor.py 1604, 1606
         main_pc_code/agents/emotion_engine.py        431, 450
         â€¦plus 30 other files in non-core groups.
     â€¢  Each line raises  SyntaxError: invalid syntax  during import,
       preventing the agent module from loading.

1.2  Other high-frequency linter errors
     â€¢  unused-import, undefined-name, duplicate-function-definition.
     â€¢  >500 warnings surfaced when running  ruff check  over agents/.

1.3  Static compilation test
     â€¢  Running  python -m py_compile $(git ls-files '*.py')  fails on
       the first â€œself.â€ occurrence â€“ proof that fixing these is the
       very first unblocker.

Suggested batch-fix script (run once after a clean commit):
--------------------------------------------------------------------
#!/usr/bin/env python3
"""
Quick-n-dirty patch: comment out stray 'self.' lines so the
interpreter can at least import the modules again.  Real fixes should
replace them with meaningful logic later.
"""
import pathlib, re, sys
ROOT = pathlib.Path(__file__).resolve().parents[1] / "main_pc_code"
pattern = re.compile(r'^\s*self\.\s*$')
for py in ROOT.rglob("*.py"):
    txt = py.read_text().splitlines(keepends=True)
    patched = [re.sub(pattern, "# TODO-FIXME â€“ removed stray 'self.'", l)
               for l in txt]
    if txt != patched:
        py.write_text("".join(patched))
--------------------------------------------------------------------

After the patch, re-run  py_compile; remaining SyntaxErrors are
usually genuine logic mistakes and will be simpler to track.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 2 â€“ ARCHITECTURE & CONFIG REVIEW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2.1  Port duplication in  startup_config.yaml
     â€¢  LearningOrchestrationService and ModelOrchestrator
       - both use  port: 7210  â†’ conflict inside the same host.
     â€¢  health_check_port values are unique, but ZMQ sockets clash
       before the HTTP checker is even started.

2.2  Docker-Compose host-port clashes (docker-compose.mainpc.yml)
     â€¢  "7210:7210" is mapped twice
         â€“ core-services container (LearningOrchestrationService)
         â€“ language-processing container (ModelOrchestrator)
     â€¢  "7225:XXXX" is also mapped twice (core-services + gpu-infra)
     â€¢  Result: second container fails to start with
         Error starting userland proxy: listen tcp4 0.0.0.0:7210â€¦

2.3  BaseAgent class
     â€¢  http_health_port = health_check_port + 1  â‡’ design is good.
     â€¢  _setup_graceful_shutdown()   is an empty stub.
     â€¢  atexit cleanup never registered.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 3 â€“ STEP-BY-STEP FIX PLAN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Step 0  (safety)  Commit the current state to a â€œpre-cleanupâ€ branch.

Step 1  Automated syntax cleanup
   1.1  Run the batch-fix script above.
   1.2  Run  python -m py_compile  on the entire tree.
        â€¢  Iterate until zero SyntaxErrors remain.
   1.3  Push fix-commit â€œBatch-remove stray self. placeholdersâ€.

Step 2  BaseAgent hardening  (single edit in common/core/base_agent.py)
   2.1  Implement _setup_graceful_shutdown:
        import signal, atexit
        def _setup_graceful_shutdown(self):
            for sig in (signal.SIGTERM, signal.SIGINT):
                signal.signal(sig, lambda *a: self.cleanup())
            atexit.register(self._atexit_cleanup)
   2.2  Test with  minimal_agent.py  inside a container; send SIGTERM
        and verify sockets close gracefully.

Step 3  Port-map sanitisation
   3.1  Decide canonical owner of host-port 7210.
        â€¢  Keep it for core-services/LearningOrchestrationService.
        â€¢  Bump ModelOrchestrator to 7213 / 8213.
   3.2  Search-replace in:
        â€¢  main_pc_code/config/startup_config.yaml
        â€¢  docker/docker-compose.mainpc.yml
   3.3  Repeat for host port 7225 (choose 7226 for gpu-infra side).
   3.4  Run  scripts/check_port_conflicts.py  (already exists) - zero
        conflicts should be reported.

Step 4  Re-generate containers
   4.1  docker compose -f docker/docker-compose.mainpc.yml build --no-cache
   4.2  docker compose up core-services  â€“ waits for HEALTHY.
   4.3  Bring up remaining groups sequentially, watching logs.

Step 5  End-to-End verification
   5.1  ./main_pc_code/scripts/start_system.py  (outside Docker)
   5.2  ./main_pc_code/tests/test_system_integration.py
   5.3  curl http://localhost:8220/health  â†’ {"status":"ok",â€¦}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PHASE 4 â€“ PROGRESSIVE GROUP VALIDATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4.1  Core Services
     â€¢  ServiceRegistry  (7200/8200)
     â€¢  SystemDigitalTwin (7220/8220)
     â€¢  ModelManagerSuite (7211/8211)
     â€¢  RequestCoordinator
     Validate each via  health_check_port  first.

4.2  Memory System  â†’  GPU Infra  â†’  Reasoning Services
     Bring up one container at a time; run  test_health_simple.py
     after each stage to ensure no regression.

4.3  Observability
     â€¢  Prometheus should scrape 9100/metrics.
     â€¢  Grafana dashboard â€œCore-Overviewâ€ should populate within 2 min.

4.4  Automated smoke test
     â€¢  ./validate_stability_fixed.py  â€“ should exit 0.
     â€¢  ./run_tests_in_container.sh   â€“ CI green.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SUCCESS CRITERIA CHECK-LIST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â˜‘  No SyntaxErrors when importing any Main-PC module
â˜‘  docker compose up  completes with all containers healthy
â˜‘  curl health endpoints for every core agent returns status ok
â˜‘  No duplicate host-ports in docker-compose.mainpc.yml
â˜‘  SIGTERM / docker stop triggers graceful cleanup (no orphans)
â˜‘  Prometheus & Grafana show all agents alive for â‰¥ 10 min

You now have a tactical roadmap that unblocks the Main-PC stack and
lets you iterate on higher-level logic later.  Good luck ğŸš€