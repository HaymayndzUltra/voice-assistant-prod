[
  {
    "id": "20240521_mainpc_hardening_plan",
    "description": "Action plan para sa pag-harden ng mga serbisyo ng Main-PC sa pamamagitan ng pag-standardize ng imports, logging, dependencies, at health checks sa lahat ng Docker groups.",
    "todos": [
      {
        "text": "A. OBSERVED PATTERNS (FAST SCAN)\n\n1. Canonical helpers in active agents\ncommon.utils.env_standardizer (network/env resolution)\ncommon.utils.path_manager\ncommon.config_manager\ncommon.core.base_agent\nmain_pc_code.utils.mainpc_error_publisher (mirrors PC-2 publisher)\ncommon.utils.log_setup.configure_logging\n\n2. Life-cycle template\n\nclass X(BaseAgent):\n    def __init__(self, port=9xxx, health_port=1xxxx):\n        super().__init__(name=\"x\", port=port)\n        self.logger = configure_logging(__name__)\n        self.error_publisher = create_mainpc_error_publisher(\"x\")\n        self.setup_sockets(); self.start_health_check()\n        self.init_thread = threading.Thread(target=self._initialize_background, daemon=True)\n        self.init_thread.start()\n\n3. Remaining inconsistencies\n\n~15 legacy agents (mostly in emotion_system, translation_services) still import legacy_config and perform sys.path hacks.\nGPU stacks (reasoning_gpu, learning_gpu, vision_gpu, speech_gpu) mix TensorFlow 2.11 and 2.15; two Dockerfiles pull latest CUDA image.\nobservability group uses structlog JSON, others plain logging.\na few services expose / as health route instead of /health.\nhard-coded localhost:4222 appears 7x (grep).\n\n──────────────────────────────────\nMAHALAGANG PAALALA: Ito ang baseline assessment ng kasalukuyang estado ng sistema. Gamitin ito bilang gabay para maunawaan ang mga umiiral na isyu bago simulan ang pag-aayos. Huwag magpatuloy hangga't hindi tapos ang kasalukuyang hakbang. Bago sumulong, i-review ang natapos at ang susunod na gagawin. Ulitin ang review kung ang confidence score ay mababa sa 95%.",
        "done": true
      },
      {
        "text": "B. PRO-ACTIVE SUGGESTIONS\nUnify logging: replace every logging.basicConfig with configure_logging(__name__).\nEliminate all sys.path.insert(); rely on PYTHONPATH=/app.\nReplace hard-coded localhost endpoints with get_mainpc_ip() or service DNS names.\nPin GPU stacks\nreasoning_gpu / learning_gpu → nvidia/cuda:12.4.1-runtime-ubuntu22.04, torch==2.1.0+cu121 or tensorflow==2.15.0.\nvision_gpu → add diffusers, transformers.\nStandardise health endpoints: FastAPI/Flask apps expose /health; ZMQ-only agents keep REP socket + lightweight Flask wrapper if needed.\nAdd missing libs: faiss-cpu (memory_stack), sentencepiece (language_stack), onnxruntime-gpu (speech_gpu).\nCompose file: make sure every service has healthcheck stanza, GPU services include deploy.resources.reservations.devices.\n\n──────────────────────────────────\nMAHALAGANG PAALALA: Ang mga mungkahi na ito ang magiging pangunahing layunin ng hardening. Unawain ang bawat item dito dahil ito ang magiging batayan ng mga gagawin sa Action Plan. Huwag magpatuloy hangga't hindi tapos ang kasalukuyang hakbang. Bago sumulong, i-review ang natapos at ang susunod na gagawin. Ulitin ang review kung ang confidence score ay mababa sa 95%.",
        "done": true
      },
      {
        "text": "C. ACTION PLAN\n(Work one group at a time; tasks repeat)\n\ninfra_core (foundation)\nConfirm Redis, NATS, error-bus build & healthy.\nEnsure configure_logging in every agent.\nRemove sys.path hacks.\ncoordination\nUpdate scheduler & registry agents to canonical imports.\nAdd /health FastAPI route to registry if missing.\n\nmemory_stack\nAdd faiss-cpu==1.7.4 to requirements.txt.\nFix two localhost:4222 literals.\n\nlanguage_stack\nPin sentencepiece==0.1.99, tokenizers==0.19.1.\nReplace legacy legacy_config import.\n\nreasoning_gpu\nSwitch Dockerfile to CUDA 12.4 runtime, install torch==2.1.0+cu121 from official wheel.\nAdd HEALTHCHECK (probe to /health or ZMQ).\n\nlearning_gpu\nSame CUDA base as reasoning_gpu, plus tensorflow==2.15.0.\nMount /workspace/data volume for model checkpoints.\n\nvision_gpu\nAdd diffusers==0.27.0, transformers==4.41.0, libgl1 apt package.\nGPU base image & health route.\n\nspeech_gpu\nPin onnxruntime-gpu==1.17.3, torchaudio==2.1.0.\nEnsure model files downloaded in build stage.\n\ntranslation_services\nRemove legacy_config; switch to standard helpers.\nUpdate Dockerfile with marian-dev==1.11.5 wheels.\n\nemotion_system\nThree agents still on old pattern; migrate to BaseAgent template + logging wrapper.\n\nobservability\nAlready uses structlog; add small bridge handler in log_setup so other agents' logs stay uniform.\n\nutility_cpu\nVerify health endpoints and imports; usually lightweight scripts.\n\n──────────────────────────────────\nMAHALAGANG PAALALA: Ito ang pangunahing execution phase. Mahigpit na sundin ang pagkakasunod-sunod at tapusin ang isang grupo bago lumipat sa susunod upang maiwasan ang dependency issues. Huwag magpatuloy hangga't hindi tapos ang kasalukuyang hakbang. Bago sumulong, i-review ang natapos at ang susunod na gagawin. Ulitin ang review kung ang confidence score ay mababa sa 95%.",
        "done": true
      },
      {
        "text": "D. EXECUTION SCRIPT SKELETON — For each group G (loop in bash):\n\ncd docker/$G\n# 1. Static scan\npython /workspace/scripts/generate_requirements_${G}.py || exit 1\n# 2. Diff & update requirements.txt (sort -u)\npip install -r requirements.txt # ensure wheels resolve\n# 3. Build\ndocker build -t mainpc_${G}:latest .\n# 4. Compose up the subset\ndocker compose --profile main up -d $(yq '.services | keys | .[]' docker-compose.yml | grep $G)\n# 5. Health check\ndocker compose ps | grep $G | grep -v healthy && exit 1\n# 6. Test imports\nCID=$(docker compose ps -q $G | head -1)\ndocker exec $CID python /app/docker/$G/test_imports.py || exit 1\n\nAutomate in build_all_mainpc_groups.sh.\n\n──────────────────────────────────\nMAHALAGANG PAALALA: Gamitin ang script na ito para sa bawat grupo upang masiguro ang pagkakapare-pareho ng proseso ng pag-build at pag-validate. Ang pag-automate ay nakakabawas ng human error. Huwag magpatuloy hangga't hindi tapos ang kasalukuyang hakbang. Bago sumulong, i-review ang natapos at ang susunod na gagawin. Ulitin ang review kung ang confidence score ay mababa sa 95%.",
        "done": false
      },
      {
        "text": "E. DONE DEFINITION\n☑ Zero sys.path.insert left in main_pc_code/agents.\n☑ logging.basicConfig removed / replaced.\n☑ python -m py_compile $(git ls-files 'main_pc_code/**/*.py') passes.\n☑ docker compose --profile main ps → all HEALTHY.\n☑ GPU images build and run with --gpus all.\n☑ Root compose (profiles main+pc2) starts full system with no unhealthy services.\nEstimated effort ≈ 12-14 engineer-hours (parallel build stages speed GPU images).\n\n──────────────────────────────────\nMAHALAGANG PAALALA: Ito ang huling checklist para sa acceptance. Ang buong gawain ay ituturing lamang na tapos kapag ang lahat ng item dito ay na-check at na-verify na. Huwag magpatuloy hangga't hindi tapos ang kasalukuyang hakbang. Bago sumulong, i-review ang natapos at ang susunod na gagawin. Ulitin ang review kung ang confidence score ay mababa sa 95%.",
        "done": false
      }
    ],
    "status": "in_progress",
    "created": "2024-05-21T12:00:00Z",
    "updated": "2025-08-05T22:53:53.470522+08:00"
  }
]