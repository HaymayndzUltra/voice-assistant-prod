[
  {
    "id": "docker_arch_blueprint_actionable_20250811",
    "description": "Actionable plan compiled from FINAL Docker Architecture Blueprint (Dual-Machine 4090 + 3060), v1.0 (Approved, Frozen). Source: memory-bank/DOCUMENTS/plan.md.",
    "todos": [
      {
        "text": "PHASE 0: SETUP & PROTOCOL (READ FIRST)\n\n**Explanations:** Establish execution protocol and global constraints from sections A–G. Enforce non-root runtime, multi-stage builds, pinned dependencies, cache strategy, health checks, and CI integration. Only produce JSON content; do not write files.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 0\n```\nIMPORTANT NOTE: Use GHCR with pinned tags (ghcr.io/<org>/<family>:YYYYMMDD-<git_sha>), non-root USER appuser, tini as PID 1, multi-stage builds, reproducible apt/pip with version locks and --require-hashes. GPU images target CUDA 12.1 with SM 8.9/8.6 and hardware-aware defaults via machine-profile.json. Trivy must fail on HIGH/CRITICAL. Every service exposes /health (HTTP 200). No direct edits to memory-bank/queue-system/tasks_active.json; JSON content only after approval.",
        "done": true
      },
      {
        "text": "PHASE 1: Build & Push Family Base Images\n\n**Explanations:** Build and publish the family per §B: base-python:3.11-slim, base-utils, base-cpu-pydeps, family-web; GPU stack base-gpu-cu121, family-torch-cu121, family-llm-cu121, family-vision-cu121; plus legacy-py310-cpu for exceptions. Tag as YYYYMMDD-<git_sha>.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 1\n```\nIMPORTANT NOTE: Enforce multi-stage builds, tini, USER appuser, pinned apt/pip with --require-hashes, and buildx registry cache (type=registry). GPU variants must embed CUDA 12.1 and set TORCH_CUDA_ARCH_LIST=\"89;86\".",
        "done": false
      },
      {
        "text": "PHASE 2: Dependency Audit (Audio/Vision)\n\n**Explanations:** Perform static and ldd-based audits to enumerate required system libs (e.g., ffmpeg, libpulse). Add OS libs only to family-torch/family-vision where justified; avoid CPU image bloat. Maintain .dockerignore exclusions per §C.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 2\n```\nIMPORTANT NOTE: Preserve slim CPU images; media/system libs go exclusively into GPU images when needed. Keep image size targets (CPU ≈100 MB, GPU ≈3 GB).",
        "done": false
      },
      {
        "text": "PHASE 3: CI Pipeline (Buildx, Cache, Scanning, SBOM)\n\n**Explanations:** Extend GitHub Actions with build matrix (family × machine) using docker buildx. Enable --cache-to/from ref=ghcr.io/<org>/cache. Run Trivy and fail on HIGH/CRITICAL. Upload SBOMs; ensure digests align with published images.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 3\n```\nIMPORTANT NOTE: CI must publish non-root runtime images with pinned dependencies. Document mitigations for GHCR cache quota and Trivy false-positives; SBOM digests must match image digests.",
        "done": false
      },
      {
        "text": "PHASE 4: Service Migration – Core Infra\n\n**Explanations:** Migrate core infrastructure services first (e.g., ServiceRegistry, SystemDigitalTwin, UnifiedSystemAgent, UnifiedObservabilityCenter) per §F. Supervisors pull newly tagged images automatically.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 4\n```\nIMPORTANT NOTE: Each service must expose /health (HTTP 200). Respect non-root runtime and health checks. Tag images as YYYYMMDD-<git_sha>. Choose rollout order to minimize blast radius.",
        "done": false
      },
      {
        "text": "PHASE 5: Service Migration – GPU Services on MainPC (4090)\n\n**Explanations:** Migrate GPU/LLM and GPU/Audio services on MainPC (e.g., ModelOpsCoordinator, AffectiveProcessingCenter, RealTimeAudioPipeline, Responder, STTService, TTSService). Apply MACHINE=mainpc profile.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 5\n```\nIMPORTANT NOTE: Enforce CUDA 12.1 baseline with SM 8.9. Apply §D defaults (threads, allocator). Validate /health and GPU visibility. Keep rollback tags available.",
        "done": false
      },
      {
        "text": "PHASE 6: Service Migration – CPU Services on PC2 (3060 host)\n\n**Explanations:** Migrate CPU services on PC2 using base-cpu-pydeps and family-web as applicable per §F. Apply MACHINE=pc2 profile and respect 3060 host constraints.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 6\n```\nIMPORTANT NOTE: Maintain CPU-only images without GPU libs. Verify /health and ports per §F. Observe thread and allocator settings from §D for pc2.",
        "done": false
      },
      {
        "text": "PHASE 7: Observability Integration\n\n**Explanations:** On service startup, emit image SBOM and Git SHA to UnifiedObservabilityCenter; verify dashboards reflect correct versions and digests across the fleet.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 7\n```\nIMPORTANT NOTE: SBOM emission must match the built image digest. Health endpoint uptime and telemetry visibility are required; failures block completion.",
        "done": false
      },
      {
        "text": "PHASE 8: Rollback Readiness & Validation\n\n**Explanations:** Validate rollback procedure: retain previous images with -prev tags; confirm supervisors can pin via FORCE_IMAGE_TAG. Exercise rollbacks for representative CPU and GPU services.\n\n**Concluding Step: Phase Completion Protocol**\n```bash\npython3 todo_manager.py show <TASK_ID>\npython3 todo_manager.py done <TASK_ID> 8\n```\nIMPORTANT NOTE: Address risks (§G): R1 driver mismatch → validate NVIDIA ≥535 or retag to -cu118; R2 legacy Py 3.10 attrition → fall back to prior legacy images; R3 GHCR cache quota → rebuild without cache; R4 Trivy false positives → temporarily downgrade policy to WARN at SBOM digest level.",
        "done": false
      }
    ],
    "status": "in_progress",
    "created": "2025-08-11T19:30:00+08:00",
    "updated": "2025-08-11T19:33:01.519573+08:00"
  }
]